{include file="public/introduction"}

		<link href="__STATIC_index__/css/cartstyle.css" rel="stylesheet" type="text/css" />
		<link href="__STATIC_index__/css/jsstyle.css" rel="stylesheet" type="text/css" />
		<script type="text/javascript" src="__STATIC_index__/js/address.js"></script>
		

			<div class="clear"></div>
			<div class="concent">
				<!--地址 -->
				<div class="paycont">
					<div class="address">
						<h3>确认收货地址 </h3>
						<div class="control">
							<div class="tc-btn createAddr theme-login am-btn am-btn-danger">使用新地址</div>
						</div>
						<div class="clear"></div>
						<ul class="address-select">
							<div class="per-border"></div>
							{volist name="userAdd" id="addr"}
							<li class="user-addresslist {if condition='$addr["is_default"] == 0'}defaultAddr{/if}" style="cursor: pointer;" data-addr_id="{$addr['address_id']}">
								<div class="address-left">
									<div class="user DefaultAddr">
										<span class="buy-address-detail">   
	                   						<span class="buy-user">{$addr['name']}</span>
											<span class="buy-phone">{$addr['mobile']}</span>
										</span>
									</div>
									<div class="default-address DefaultAddr">
										<span class="buy-line-title buy-line-title-type">收货地址：</span>
										<span class="buy-address-detail">
									   		<span class="province">{$addr['country']}</span>
											<span class="city">{$addr['province']}</span>
											<span class="dist">{$addr['city']}</span>
											<span class="street">{$addr['address']}</span>
										</span>
									</div>
									<?php if($addr['is_default'] == 0){echo '<ins class="deftip">默认地址</ins>';}?>
								</div>
								<div class="address-right">
									<a href="../person/address.html">
										<span class="am-icon-angle-right am-icon-lg"></span></a>
								</div>
								<div class="clear"></div>

								<div class="new-addr-btn" style="display: none">
									<a href="javascript:void('0')" <?php if($addr['is_default'] == 0){echo 'class="hidden"';}?>>设为默认</a>
									<span class="new-addr-bar hidden">|</span>
									<a href="javascript:void('0')">编辑</a>
									<span class="new-addr-bar">|</span>
									<a href="javascript:void(0);" onclick="delClick(this);">删除</a>
								</div>

							</li>
							<div class="per-border"></div>
							{/volist}
						</ul>

						<div class="clear"></div>
					</div>
					<!--物流 -->
					<!-- <div class="logistics">
						<h3>选择物流方式</h3>
						<ul class="op_express_delivery_hot">
							{volist name="kuaidi" id="kuaidilist"}
								<li data-value="{$kuaidilist['id']}" class="OP_LOG_BTN  "><img src="{$kuaidilist['logo']}" style="width: 36px;height: 36px" />{$kuaidilist['name']}<span></span></li>
							{/volist}
						</ul>
					</div>
					<div class="clear"></div> -->

					<!--支付方式-->
					<!-- <div class="logistics">
						<h3>选择支付方式</h3>
						<ul class="pay-list">
							{volist name="pay" id="paylist"}
								<li class="pay card" data-value="{$paylist['id']}"><img src="{$paylist['pay_img']}" style="width: 36px;height: 36px" />{$paylist['pay_name']}<span></span></li>
							{/volist}
						</ul>
					</div>
					<div class="clear"></div> -->

					<!--订单 -->
					<div class="concent">
						<div id="payTable">
							<h3>确认订单信息</h3>
							<div class="cart-table-th">
								<div class="wp">

									<div class="th th-item">
										<div class="td-inner">商品信息</div>
									</div>
									<div class="th th-price">
										<div class="td-inner">单价</div>
									</div>
									<div class="th th-amount">
										<div class="td-inner">数量</div>
									</div>
									<div class="th th-sum">
										<div class="td-inner">金额</div>
									</div>
									<div class="th th-oplist">
										<div class="td-inner">配送方式</div>
									</div>

								</div>
							</div>
							<div class="clear"></div>
								<tr class="item-list">
								<div class="bundle  bundle-last">

									<div class="bundle-main">
										{volist name="goodsItemList" id="goodsList"}
											<ul class="item-content clearfix">
												<div class="pay-phone">
													<li class="td td-item">
														<div class="item-pic">
															<a href="#" class="J_MakePoint">
																<img src="<?php echo 'http://'.$_SERVER['HTTP_HOST'].str_replace('\\','/',$goodsList['goods']['original_img']);?>" class="itempic J_ItemImg"></a>
														</div>
														<div class="item-info">
															<div class="item-basic-info">
																<a href="#" class="item-title J_MakePoint" data-point="tbcart.8.11">{$goodsList['goods']['goods_name']}</a>
															</div>
														</div>
													</li>
													<li class="td td-info">
														<div class="item-props">
															<span class="sku-line" data-itemId="{$goodsList['item']['itemSpeclist']}">{$goodsList['item']['item_name']}</span>
															<!-- <span class="sku-line">包装：裸装</span> -->
														</div>
													</li>
													<li class="td td-price">
														<div class="item-price price-promo-promo">
															<div class="price-content">
																<em class="J_Price price-now">{$goodsList['item']['price']}</em>
															</div>
														</div>
													</li>
												</div>
												<li class="td td-amount">
													<div class="amount-wrapper ">
														<div class="item-amount ">
															<span class="phone-title">购买数量</span>
															<div class="sl">
																<input class="am-btn" id="min" name="reduceNum" type="button" value="-" />
																<input class="text_box" name="goodsNum" onkeyup="this.value=value.replace(/[^\d]/g,'')" type="text" value="{$goodsList['goods']['num']}" style="width:30px;text-align: center;" />
																<input type="hidden" name="goodsid" value="{$goodsList['goods']['goods_id']}">
																<input class="am-btn" id="add" name="addNum" type="button" value="+" />
															</div>
														</div>
													</div>
												</li>
												<li class="td td-sum">
													<div class="td-inner">
														<em tabindex="0" data-price="{$goodsList['item']['price']}" class="J_ItemSum number"><?php echo $goodsList['item']['price']*$goodsList['goods']['num'];?></em>
													</div>
												</li>
												<li class="td td-oplist">
													<div class="td-inner">
														<span class="phone-title">配送方式</span>
														<div class="pay-logis">
															{if condition="$goodsList['goods']['is_free_shipping'] == 1"}
																包邮
															{else}
															快递:<b class="sys_item_freprice">10</b>元
															{/if}
														</div>
													</div>
												</li>

											</ul>

										{/volist}
										<div class="clear"></div>
									</div>
							</tr>
							<div class="clear"></div>
							</div>
							<div class="clear"></div>
							<div class="pay-total">
						<!--留言-->
							<div class="order-extra">
								<div class="order-user-info">
									<div id="holyshit257" class="memo">
										<label>买家留言：</label>
										<input style="height: 30px;" type="text" name="liuyan" title="选填,对本次交易的说明（建议填写已经和卖家达成一致的说明）" placeholder="选填,建议填写和卖家达成一致的说明" class="memo-input J_MakePoint c2c-text-default memo-close">
										<div class="msg hidden J-msg">
											<p class="error">最多输入500个字符</p>
										</div>
									</div>
								</div>

							</div>
							<!--优惠券 -->
							<!-- 
							<div class="buy-agio">
								<li class="td td-coupon">

									<span class="coupon-title">优惠券</span>
									<select data-am-selected>
										<option value="a">
											<div class="c-price">
												<strong>￥8</strong>
											</div>
											<div class="c-limit">
												【消费满95元可用】
											</div>
										</option>
										<option value="b" selected>
											<div class="c-price">
												<strong>￥3</strong>
											</div>
											<div class="c-limit">
												【无使用门槛】
											</div>
										</option>
									</select>
								</li>

								<li class="td td-bonus">

									<span class="bonus-title">红包</span>
									<select data-am-selected>
										<option value="a">
											<div class="item-info">
												¥50.00<span>元</span>
											</div>
											<div class="item-remainderprice">
												<span>还剩</span>10.40<span>元</span>
											</div>
										</option>
										<option value="b" selected>
											<div class="item-info">
												¥50.00<span>元</span>
											</div>
											<div class="item-remainderprice">
												<span>还剩</span>50.00<span>元</span>
											</div>
										</option>
									</select>

								</li>

							</div> -->
							<div class="clear"></div>
							</div>
							<!--含运费小计 -->
							<div class="buy-point-discharge ">
								<p class="price g_price ">
									合计（含运费） <span>¥</span><em class="pay-sum"><?php echo $goodsList['item']['price']*$goodsList['goods']['num'];?></em>
								</p>
							</div>

							<!--信息 -->
							<div class="order-go clearfix">
								<div class="pay-confirm clearfix">
									<div class="box">
										<div tabindex="0" id="holyshit267" class="realPay"><em class="t">实付款：</em>
											<span class="price g_price ">
                                    <span>¥</span> <em class="style-large-bold-red " id="J_ActualFee"><?php echo $goodsList['item']['price']*$goodsList['goods']['num'];?></em>
											</span>
										</div>

										<div id="holyshit268" class="pay-address">

											<p class="buy-footer-address">
												<span class="buy-line-title buy-line-title-type">寄送至：</span>
												<span class="buy-address-detail">
									   				<span class="province">{$userAddrDef['country']}</span>
													<span class="city">{$userAddrDef['province']}</span>
													<span class="dist">{$userAddrDef['city']}</span>
													<span class="street">{$userAddrDef['address']}</span>
												</span>
												</span>
											</p>
											<p class="buy-footer-address">
												<span class="buy-line-title">收货人：</span>
												<span class="buy-address-detail">   
	                                         		<span class="buy-user">{$userAddrDef['name']}</span>
													<span class="buy-phone">{$userAddrDef['mobile']}</span>
												</span>
											</p>
										</div>
									</div>

									<div id="holyshit269" class="submitOrder" style="padding-top: 100px;">
										<div class="go-btn-wrap">
											<input type="hidden" name="__ordertoken__"  value="{$Request.token}">
											<a id="J_Go" href="javascript:void(0)" class="btn-go" tabindex="0" title="点击此按钮，提交订单">提交订单</a>
										</div>
									</div>
									<div class="clear"></div>
								</div>
							</div>
						</div>

						<div class="clear"></div>
					</div>
				</div>
<form id="order_goods_form" method="POST" action="">
	<input type="hidden" name="order_wuliu" value="">
	<input type="hidden" name="order_pay" value="">
	<input type="hidden" name="order_address" value="">
	<input type="hidden" name="order_goodsNum" value="">
	<input type="hidden" name="order_goodsid" value="">
	<input type="hidden" name="order_liuyan" value="">
	<input type="hidden" name="__token__" value="{$Request.token}" />
</form>
				<div class="footer" style="display: none;">
					<div class="footer-hd">
						<p>
								<b>|</b>
								<a href="# ">商城首页</a>
								<b>|</b>
								<a href="# ">支付宝</a>
								<b>|</b>
								<a href="# ">物流</a>
							</p>
						</div>
						<div class="footer-bd ">
							<p>
								<a href="# ">合作伙伴</a>
								<a href="# ">联系我们</a>
								<a href="# ">网站地图</a>
							</p>
					</div>
				</div>
			</div>
			<div class="theme-popover-mask"></div>
			<div class="theme-popover">

				<!--标题 -->
				<div class="am-cf am-padding">
					<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">新增地址</strong> / <small>Add address</small></div>
				</div>
				<hr/>

				<div class="am-u-md-12">
					<form class="am-form am-form-horizontal" id="addrForm">

						<div class="am-form-group">
							<label for="consignee" class="am-form-label">收货人</label>
							<div class="am-form-content">
								<input type="text" id="consignee" placeholder="收货人" style="width: 80%;">
							</div>
						</div>

						<div class="am-form-group">
							<label for="mobile" class="am-form-label">手机号码</label>
							<div class="am-form-content">
								<input id="mobile" maxlength="11" onkeyup = "value=value.replace(/[^\d]/g,'')" placeholder="手机号必填" type="text" style="width: 80%;">
							</div>
						</div>

						<div class="am-form-group">
							<label for="zipcode" class="am-form-label">邮编</label>
							<div class="am-form-content">
								<input id="zipcode" maxlength="6" onkeyup = "value=value.replace(/[^\d]/g,'')" placeholder="邮编:默认为000000" type="text" style="width: 80%;">
							</div>
						</div>

						<div class="am-form-group">
							<label for="addr" class="am-form-label">所在地</label>
							<div class="am-form-content address">
								<select id="parse_one" style="width: 100px;height: 30px;padding-left: 10px;font-size: 12px;color: #444;" class="province">
									<option>请选择</option>
								</select>
								<select id="parse_two" style="width: 100px;height: 30px;padding-left: 10px;font-size: 12px;color: #444;" class="city">
									<option>请选择省</option>
								</select>
								<select id="parse_thr" style="width: 100px;height: 30px;padding-left: 10px;font-size: 12px;color: #444;" class="district">
									<option>请选择市</option>
								</select>
							</div>
						</div>

						<div class="am-form-group" >
							<label for="address" class="am-form-label">详细地址</label>
							<div class="am-form-content">
								<textarea class="" rows="3" style="width: 80%;" id="address" placeholder="输入详细地址"></textarea>
								<small>100字以内写出你的详细地址...</small>
							</div>
						</div>
						<input type="hidden" name="__token__"  value="{$Request.token}">
						<div class="am-form-group theme-poptit" style="display: block;">
							<div class="am-u-sm-9 am-u-sm-push-3">
								<div class="am-btn am-btn-danger" id="addrSubmit">保存</div>
								<div class="am-btn am-btn-danger close" style="color: white;">取消</div>
							</div>
						</div>
					</form>
				</div>

			</div>

			<div class="clear"></div>
	<!--       底部             -->
{include file="public/bottom"}
<script>
	$(function(){
		/*******************  表单提交  **************************/
		$('#addrSubmit').click(function(){
			var data = {
					'consignee':$('#consignee').val(),
					'mobile':$('#mobile').val(),
					'zipcode':$('#zipcode').val(),
					'country':100000,
					'province':$('#parse_one').val(),
					'city':$('#parse_two').val(),
					'district':$('#parse_thr').val(),
					'twon':0,
					'address':$('#address').val(),
			};
			$.ajax({
				'type' : 'post',
				'url'  : '{:Url("pay/userAdd")}',
				'data' : {'data':JSON.stringify(data)},
				'dataType' : 'json',
				success:function(data){
					var data = JSON.parse(data);
					if (data['code'] == 0) {
						alert(data['msg']);
					}else{
						alert(data['msg']);
						$('.close').trigger('click');
						window.location.reload();
					}
				},
				error:function(data){
					alert('网络出错,请重新尝试提交');
				}
			})
		})

//******************************   请选择地址  ******************************************************//		
		var dizhi = JSON.parse('<?php echo json_encode($city);?>');
		var par_one = [];
		var b = 0;
		for (var i = 0; i < dizhi.length; i++) {
			if (dizhi[i]['ParentId'] == 100000) {   // 父级为100000
                $('#parse_one').append('<option value="'+dizhi[i]['id']+'">'+dizhi[i]['Name']+'</option>');
			}
		}
//*************************************************************************************************//
	$('#parse_one').on('change',function(){
		 $('#parse_two').html('<option>请选择省</option>');
		 $('#parse_thr').html('<option>请选择市</option>');
		for (var i = 0; i < dizhi.length; i++) {
			if (dizhi[i]['ParentId'] == $(this).val()) {   // 父级为100000
                $('#parse_two').append('<option value="'+dizhi[i]['id']+'">'+dizhi[i]['Name']+'</option>');
			}
		}
	})

		$('#parse_two').on('change',function(){
		 $('#parse_thr').html('<option>请选择市</option>');
		for (var i = 0; i < dizhi.length; i++) {
			if (dizhi[i]['ParentId'] == $(this).val()) {   // 父级为100000
                $('#parse_thr').append('<option value="'+dizhi[i]['id']+'">'+dizhi[i]['Name']+'</option>');
			}
		}
	})
	})
</script>